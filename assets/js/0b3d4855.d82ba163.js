"use strict";(self.webpackChunkmysite=self.webpackChunkmysite||[]).push([[5366],{28453:(e,n,l)=>{l.d(n,{R:()=>a,x:()=>i});var s=l(96540);const c={},r=s.createContext(c);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},43139:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"k8s/LoadBalancer","title":"LoadBalancer","description":"\u5b89\u88c5openelb","source":"@site/docs/k8s/LoadBalancer.md","sourceDirName":"k8s","slug":"/k8s/LoadBalancer","permalink":"/docs/k8s/LoadBalancer","draft":false,"unlisted":false,"editUrl":"https://github.com/gavintan/notes/docs/k8s/LoadBalancer.md","tags":[],"version":"current","frontMatter":{},"sidebar":"doc","previous":{"title":"Ingress","permalink":"/docs/k8s/Ingress"},"next":{"title":"\u5b58\u50a8\u7c7b","permalink":"/docs/k8s/\u5b58\u50a8\u7c7b"}}');var c=l(74848),r=l(28453);const a={},i=void 0,o={},d=[{value:"\u5b89\u88c5openelb",id:"\u5b89\u88c5openelb",level:2},{value:"\u4f7f\u7528layer2\u6a21\u5f0f",id:"\u4f7f\u7528layer2\u6a21\u5f0f",level:2},{value:"svc\u4f7f\u7528loadbalancer",id:"svc\u4f7f\u7528loadbalancer",level:2}];function t(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h2,{id:"\u5b89\u88c5openelb",children:"\u5b89\u88c5openelb"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f https://raw.githubusercontent.com/openelb/openelb/master/deploy/openelb.yaml\n"})}),"\n",(0,c.jsx)(n.h2,{id:"\u4f7f\u7528layer2\u6a21\u5f0f",children:"\u4f7f\u7528layer2\u6a21\u5f0f"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"metadata"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"name"}),": Name of the Eip object."]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"spec"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"address"}),": \u4e00\u4e2a\u6216\u591a\u4e2a IP \u5730\u5740:","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"192.168.0.100"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"192.168.0.0/24"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"192.168.0.91-192.168.0.100"}),"."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"protocol"}),": \u6307\u5b9a Eip \u5bf9\u8c61\u7528\u4e8e\u54ea\u79cd OpenELB \u6a21\u5f0f\u3002\u8be5\u503c\u53ef\u4ee5\u662f",(0,c.jsx)(n.code,{children:"layer2"}),"\u6216",(0,c.jsx)(n.code,{children:"bgp"}),"\u3002\u5982\u679c\u672a\u6307\u5b9a\u6b64\u5b57\u6bb5\uff0c",(0,c.jsx)(n.code,{children:"bgp"}),"\u5219\u4f7f\u7528\u9ed8\u8ba4\u503c\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"interface"}),"\uff1aOpenELB \u5728\u5176\u4e0a\u4fa6\u542c ARP \u6216 NDP \u8bf7\u6c42\u7684 NIC\u3002\u8be5\u5b57\u6bb5\u4ec5\u5728",(0,c.jsx)(n.code,{children:"protocol"}),"\u8bbe\u7f6e\u4e3a\u65f6\u6709\u6548",(0,c.jsx)(n.code,{children:"layer2"}),"\u3002"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f layer2-eip.yaml\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",metastring:"title=layer2-eip.yaml",children:"apiVersion: network.kubesphere.io/v1alpha2\nkind: Eip\nmetadata:\n  name: layer2-eip\nspec:\n  address: 192.168.0.91-192.168.0.100\n  interface: eth0\n  protocol: layer2\n            \n"})}),"\n",(0,c.jsx)(n.h2,{id:"svc\u4f7f\u7528loadbalancer",children:"svc\u4f7f\u7528loadbalancer"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\u60a8\u5fc5\u987b\u8bbe\u7f6e",(0,c.jsx)(n.code,{children:"spec:type"}),"\u4e3a",(0,c.jsx)(n.code,{children:"LoadBalancer"}),"\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"lb.kubesphere.io/v1alpha1: openelb"}),"\u6ce8\u91ca\u6307\u5b9a\u670d\u52a1\u4f7f\u7528 OpenELB \u3002"]}),"\n",(0,c.jsxs)(n.li,{children:["\u8be5",(0,c.jsx)(n.code,{children:"protocol.openelb.kubesphere.io/v1alpha1: layer2"}),"\u6ce8\u91ca\u6307\u5b9a OpenELB \u7528\u4e8e\u7b2c 2 \u5c42\u6a21\u5f0f\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"eip.openelb.kubesphere.io/v1alpha2: layer2-eip"}),"\u6ce8\u89e3\u6307\u5b9a OpenELB \u4f7f\u7528\u7684 Eip \u5bf9\u8c61\u3002\u5982\u679c\u672a\u914d\u7f6e\u6b64\u6ce8\u89e3\uff0cOpenELB \u4f1a\u81ea\u52a8\u4f7f\u7528\u4e0e\u534f\u8bae\u5339\u914d\u7684\u7b2c\u4e00\u4e2a\u53ef\u7528 Eip \u5bf9\u8c61\u3002\u60a8\u4e5f\u53ef\u4ee5\u5220\u9664\u6b64\u6ce8\u89e3\u5e76\u6dfb\u52a0",(0,c.jsx)(n.code,{children:"spec:loadBalancerIP"}),"\u5b57\u6bb5\uff08\u4f8b\u5982",(0,c.jsx)(n.code,{children:"spec:loadBalancerIP: 192.168.0.91"}),"\uff09\u4ee5\u5c06\u7279\u5b9a IP \u5730\u5740\u5206\u914d\u7ed9\u670d\u52a1\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:["\u5982\u679c",(0,c.jsx)(n.code,{children:"spec:externalTrafficPolicy"}),"\u8bbe\u7f6e\u4e3a",(0,c.jsx)(n.code,{children:"Cluster"}),"\uff08\u9ed8\u8ba4\u503c\uff09\uff0cOpenELB \u4ece\u6240\u6709 Kubernetes \u96c6\u7fa4\u8282\u70b9\u4e2d\u968f\u673a\u9009\u62e9\u4e00\u4e2a\u8282\u70b9\u6765\u5904\u7406 Service \u8bf7\u6c42\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7 kube-proxy \u8bbf\u95ee\u5176\u4ed6\u8282\u70b9\u4e0a\u7684 Pod\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:["\u5982\u679c",(0,c.jsx)(n.code,{children:"spec:externalTrafficPolicy"}),"\u8bbe\u7f6e\u4e3a",(0,c.jsx)(n.code,{children:"Local"}),"\uff0cOpenELB \u4f1a\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u968f\u673a\u9009\u62e9\u4e00\u4e2a\u5305\u542b Pod \u7684\u8282\u70b9\u6765\u5904\u7406 Service \u8bf7\u6c42\u3002\u53ea\u80fd\u8bbf\u95ee\u9009\u5b9a\u8282\u70b9\u4e0a\u7684 Pod\u3002"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",metastring:"title=nginx-svc.yaml",children:"kind: Service\napiVersion: v1\nmetadata:\n  name: nginx-svc\n  annotations:\n    lb.kubesphere.io/v1alpha1: openelb\n    protocol.openelb.kubesphere.io/v1alpha1: layer2\n    eip.openelb.kubesphere.io/v1alpha2: layer2-eip\nspec:\n  selector:\n    app: nginx\n  type: LoadBalancer\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 80\n  externalTrafficPolicy: Cluster\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(t,{...e})}):t(e)}}}]);