"use strict";(self.webpackChunkmysite=self.webpackChunkmysite||[]).push([[873],{16872:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>u,frontMatter:()=>d,metadata:()=>t,toc:()=>o});var l=s(13274),a=s(1780);const d={},c=void 0,t={id:"k8s/\u5b58\u50a8\u7c7b",title:"\u5b58\u50a8\u7c7b",description:"Glusterfs",source:"@site/docs/k8s/\u5b58\u50a8\u7c7b.md",sourceDirName:"k8s",slug:"/k8s/\u5b58\u50a8\u7c7b",permalink:"/docs/k8s/\u5b58\u50a8\u7c7b",draft:!1,unlisted:!1,editUrl:"https://github.com/gavintan/notes/docs/k8s/\u5b58\u50a8\u7c7b.md",tags:[],version:"current",frontMatter:{},sidebar:"doc",previous:{title:"LoadBalancer",permalink:"/docs/k8s/LoadBalancer"},next:{title:"\u96c6\u7fa4\u5347\u7ea7",permalink:"/docs/k8s/\u96c6\u7fa4\u5347\u7ea7"}},r={},o=[{value:"Glusterfs",id:"glusterfs",level:2},{value:"\u5b89\u88c5kadalu",id:"\u5b89\u88c5kadalu",level:3},{value:"\u521b\u5efastorage",id:"\u521b\u5efastorage",level:3},{value:"\u5220\u9664kadalu",id:"\u5220\u9664kadalu",level:3},{value:"Openebs",id:"openebs",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:3},{value:"\u521b\u5efa\u81ea\u5b9a\u4e49\u8def\u5f84StorageClass",id:"\u521b\u5efa\u81ea\u5b9a\u4e49\u8def\u5f84storageclass",level:3}];function i(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"glusterfs",children:"Glusterfs"}),"\n",(0,l.jsx)(n.h3,{id:"\u5b89\u88c5kadalu",children:"\u5b89\u88c5kadalu"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"curl -fsSL https://github.com/kadalu/kadalu/releases/latest/download/install.sh | sudo bash -x\nkubectl-kadalu version\nkubectl kadalu install --type=kubernetes\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u521b\u5efastorage",children:"\u521b\u5efastorage"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u672c\u673a\u6a21\u5f0f"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"--device \u4f7f\u7528\u672c\u5730\u8bbe\u5907"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"--path \u4f7f\u7528\u672c\u5730\u8def\u5f84"})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Replica1"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0cGluster\u542f\u52a8\u65f6\u6ca1\u6709\u9ad8\u53ef\u7528\u6027\uff0c\u5373\u6ca1\u6709\u590d\u5236\u6a21\u5757\u3002\u5b83\u5c06\u53ea\u4f7f\u7528\u4e00\u4e2a\u5b58\u50a8\uff0cRWX\u548cRWO PV\u5c06\u4ece\u5176\u4e2d\u5206\u5272\u51fa\u6765\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl kadalu storage-add storage-pool1 --type=Replica1 \\\n    --device kube-nodename1:/dev/vdc\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Replica2"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:'\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0cGluster\u5c06\u4ee5\u9ad8\u53ef\u7528\u6027\u542f\u52a8\uff0c\u4f7f\u7528 "tie-breaker"\uff08\u6216gluster\u672f\u8bed\u4e2d\u7684thin-arbiter\uff09\u9009\u9879\u3002\u5b83\u5c06\u4f7f\u75282\u4e2a\u5b58\u50a8\u9009\u9879\uff0c\u5176\u4e2dRWX\u548cRWO PV\u5c06\u88ab\u5206\u5272\u51fa\u6765'}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl kadalu storage-add storage-pool1 --type=Replica2 \\\n    --device kube-nodename1:/dev/vdc \\\n    --device kube-nodename2:/dev/vdc\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Replica3"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0cGluster\u5c06\u4ee5\u9ad8\u53ef\u7528\u6027\u542f\u52a8\uff0c\u5373\u590d\u5236\u6a21\u5757\u3002\u5b83\u9700\u8981\u63d0\u4f9b3\u4e2a\u5b58\u50a8\u9009\u9879\uff0c\u6bcf\u4e2a\u5b58\u50a8\u5c06\u662f\u4e00\u4e2a\u4f5c\u4e3apod\u8fd0\u884c\u7684gluster\u670d\u52a1\u5668\u8fdb\u7a0bpod\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl kadalu storage-add storage-pool1 --type=Replica3 \\\n    --device kube-nodename1:/dev/vdc \\\n    --device kube-nodename2:/dev/vdc \\\n    --device kube-nodename3:/dev/vdc\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Disperse"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u5206\u6563\u5377\u662f\u57fa\u4e8e\u64e6\u9664\u4ee3\u7801\u7684\u3002\u5b83\u5c06\u6587\u4ef6\u7684\u7f16\u7801\u6570\u636e\uff0c\u52a0\u4e0a\u4e00\u4e9b\u5197\u4f59\uff0c\u5728\u5377\u4e2d\u7684\u591a\u4e2a\u7816\u5757\u4e0a\u5265\u79bb\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u5206\u6563\u5377\uff0c\u4ee5\u6700\u5c0f\u7684\u7a7a\u95f4\u6d6a\u8d39\u83b7\u5f97\u53ef\u914d\u7f6e\u7684\u53ef\u9760\u6027\u6c34\u5e73\u3002\u8fd9\u79cd\u6a21\u5f0f\u81f3\u5c11\u9700\u89813\u4e2a\u5b58\u50a8\u7a7a\u95f4\uff0c\u5e76\u6839\u636e\u9700\u8981\u589e\u52a0\u5b58\u50a8\u7a7a\u95f4\u7684\u6570\u91cf\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl kadalu storage-add storage-pool1 --type=Disperse \\\n    --data 2 --redundancy 1          \\\n    --device kube-nodename1:/dev/vdc \\\n    --device kube-nodename2:/dev/vdc \\\n    --device kube-nodename3:/dev/vdc\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u5916\u90e8\u6a21\u5f0f\uff08\u4f7f\u7528\u5916\u90e8glusterfs\uff09"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl kadalu storage-add storage-pool-1 --external 172.16.7.14:/gv1\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u5220\u9664kadalu",children:"\u5220\u9664kadalu"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"curl -s https://raw.githubusercontent.com/kadalu/kadalu/devel/extras/scripts/cleanup | bash\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u94fe\u63a5\uff1a",(0,l.jsx)(n.a,{href:"https://github.com/kadalu/kadalu",children:"https://github.com/kadalu/kadalu"})]}),"\n",(0,l.jsx)(n.h2,{id:"openebs",children:"Openebs"}),"\n",(0,l.jsx)(n.p,{children:"\u4e0e\u539f\u751f Kubernetes \u4e3b\u673a\u8def\u5f84\u5377\u76f8\u6bd4\uff0c OpenEBS \u672c\u5730 PV \u4e3b\u673a\u8def\u5f84\u5377\u5177\u6709\u4ee5\u4e0b\u4f18\u52bf\u3002"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"OpenEBS Local PV Hostpath \u5141\u8bb8\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u901a\u8fc7 StorageClass\u3001PVC \u548c PV \u8bbf\u95ee hostpath\u3002\u8fd9\u4e3a\u60a8\u63d0\u4f9b\u4e86\u66f4\u6539 PV \u63d0\u4f9b\u7a0b\u5e8f\u7684\u7075\u6d3b\u6027\uff0c\u800c\u65e0\u9700\u91cd\u65b0\u8bbe\u8ba1\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f YAML\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u4f7f\u7528 Velero \u5907\u4efd\u548c\u6062\u590d\u7684\u6570\u636e\u4fdd\u62a4\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u901a\u8fc7\u5b8c\u5168\u5c4f\u853d\u5e94\u7528\u7a0b\u5e8f YAML \u548c pod \u7684\u4e3b\u673a\u8def\u5f84\u6765\u9632\u6b62\u4e3b\u673a\u8def\u5f84\u5b89\u5168\u6f0f\u6d1e\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f https://openebs.github.io/charts/openebs-operator.yaml\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u521b\u5efa\u81ea\u5b9a\u4e49\u8def\u5f84storageclass",children:"\u521b\u5efa\u81ea\u5b9a\u4e49\u8def\u5f84StorageClass"}),"\n",(0,l.jsxs)(n.p,{children:["openebs\u9ed8\u8ba4\u5b58\u50a8\u8def\u5f84\u5728\u4e3b\u673a",(0,l.jsx)(n.code,{children:"/var/openebs/local"}),"\uff0c\u624b\u52a8\u521b\u5efaSC"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:"title=local-hostpath-sc.yaml",children:"apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: local-hostpath\n  annotations:\n    openebs.io/cas-type: local\n    cas.openebs.io/config: |\n      - name: StorageType\n        value: hostpath\n      - name: BasePath\n        value: /data/openebs-data\nprovisioner: openebs.io/local\nreclaimPolicy: Delete\nvolumeBindingMode: WaitForFirstConsumer\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u94fe\u63a5\uff1a",(0,l.jsx)(n.a,{href:"https://openebs.io/docs/user-guides/localpv-hostpath",children:"https://openebs.io/docs/user-guides/localpv-hostpath"})]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(i,{...e})}):i(e)}},1780:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>t});var l=s(79474);const a={},d=l.createContext(a);function c(e){const n=l.useContext(d);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),l.createElement(d.Provider,{value:n},e.children)}}}]);